\documentclass[ngerman]{dis-template-add}


\renewcommand{\Aufgabenblatt}{1}
\renewcommand{\Ausgabedatum}{28. April 2020}
\renewcommand{\Abgabedatum}{8. Mai 2020}
\renewcommand{\Gruppe}{Simon Weidmann, Aram Yesildeniz}
\renewcommand{\STiNEGruppe}{14}


\begin{document}


\section*{1.2 DB-Schema}

\subsection*{Tabellen}

=> Horizontal Partitioning

\begin{center}

Estate Agent \\
\begin{tabular}{ c | c | c | c }
 \soliduline{Login} & Name & Address & Password \\
 \hline
  & & & \\
\end{tabular}

Estate \\
\begin{tabular}{ c | c | c | c | c | c | c }
 \soliduline{ID} & City & Postal Code & Street & Street Number & Square Area & \dashuline{EsateAgent.Login} \\
 \hline
  & & & & & & \\
\end{tabular}

Apartment \\
\begin{tabular}{ c | c | c | c | c | c | c | c | c | c | c | c }
 \soliduline{ID} & City & PC & Str. & Str.Nr. & SA & Floor & Rent & Rooms & Balcony & B.i. Kitchen & \dashuline{EsateAgent.Login} \\
 \hline
  & & & & & & & & & & &  \\
\end{tabular}

House \\
\begin{tabular}{ c | c | c | c | c | c | c | c | c | c }
 \soliduline{ID} & City & PC & Str. & Str.Nr. & SA & Floors & Price & Garden & \dashuline{EsateAgent.Login} \\
 \hline
  & & & & & & & & & \\
\end{tabular}

Person \\
\begin{tabular}{ c | c | c | c }
 \soliduline{ID} & First Name & Name & Address \\
 \hline
  & & & \\
\end{tabular}

Contract \\
\begin{tabular}{ c | c | c  }
 \soliduline{Contract No.} & Date & Place\\
 \hline
  & & \\
\end{tabular}
  
Tenancy Contract  \\
\begin{tabular}{ c | c | c  | c | c  | c | c | c  }
 \soliduline{Con.No.} & Date & Place & Start D. & Dur. & Add.Costs & \dashuline{Person.ID} & \dashuline{Apartment.ID} \\
 \hline
  & & & & & & & \\
\end{tabular}

Purchase Contract  \\
\begin{tabular}{ c | c | c  | c | c  | c | c  }
 \soliduline{Con.No.} & Date & Place & No.of.Install. & Intrest Rate & \dashuline{Person.ID} & \dashuline{House.ID} \\
 \hline
  & & & & & & \\
\end{tabular}

\end{center}


%\begin{RMSchma}
%Person(\soliduline{PID}, Name, Vorname, \dashuline{(HaustierName, HaustierRasse) $\rightarrow$ (Haustier.Name, Haustier.Rasse)})
%Haustier(\soliduline{Name, Rasse}, \dashuline{Herrchen $\rightarrow$ Person.PID})
%\end{RMSchma}




%\section{Beispiel für Ausdruck der Relationenalgebra}

%\begin{align*}
% &\umbenennung{Rasse}{Sorte}(\projektion{Rasse, Geschlecht}((Wolf\verbund{Wolf.WID=Haustier.HID} (\selektion{Name=\wert{Hasso}}Haustiere)) \natverbund Person))
%\\  &=\{ \wert{Steppenwolf}, \wert{m} \}
%\end{align*}


\subsection*{SQL Scripts}

\subsection*{Datenbank erstellen}

\begin{verbatim}
CREATE DATABASE dis
    WITH 
    OWNER = postgres
    ENCODING = 'UTF8'
    CONNECTION LIMIT = -1;
\end{verbatim}


\subsection*{Tabellen erstellen}

\begin{verbatim}
CREATE TABLE public.estate_agent
(
    agent_login text,
    agent_name text,
    agent_address text,
    agent_password text,
    PRIMARY KEY (agent_login)
);

ALTER TABLE public.estate_agent
    OWNER to postgres;
    

CREATE TABLE public.estate
(
    estate_id serial,
    city text,
    postcal_code integer,
    street text,
    street_number text,
    square_area integer,
    manager text,
    PRIMARY KEY (estate_id),
    CONSTRAINT manager FOREIGN KEY (manager)
        REFERENCES public.estate_agent (agent_login) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
        NOT VALID
);

ALTER TABLE public.estate
    OWNER to postgres;


CREATE TABLE public.apartment
(
    floor integer,
    rent text,
    rooms text,
    balcony boolean,
    kitchen boolean,
    CONSTRAINT apartment_pkey PRIMARY KEY (estate_id),
    CONSTRAINT manager FOREIGN KEY (manager)
        REFERENCES public.estate_agent (agent_login) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
        NOT VALIDapar
)
    INHERITS (public.estate);

ALTER TABLE public.apartment
    OWNER to postgres;


CREATE TABLE public.house
(
    floors integer,
    price text,
    garden boolean,
    CONSTRAINT house_pkey PRIMARY KEY (estate_id),
    CONSTRAINT manager FOREIGN KEY (manager)
        REFERENCES public.estate_agent (agent_login) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)
    INHERITS (public.estate)
TABLESPACE pg_default;

ALTER TABLE public.house
    OWNER to postgres;


CREATE TABLE public.person
(
    id serial,
    first_name text,
    last_name text,
    address text,
    PRIMARY KEY (id)
);

ALTER TABLE public.person
    OWNER to postgres;


CREATE TABLE public.contract
(
    contract_number serial,
    contract_date date,
    place text,
    PRIMARY KEY (contract_number)
);

ALTER TABLE public.contract
    OWNER to postgres;


CREATE TABLE public.tenancy_contract
(
    start_date date,
    duration text,
    additional_costs text,
    person_id integer,
    apartment_id integer,
    CONSTRAINT tenancy_contract_pkey PRIMARY KEY (contract_number),
    CONSTRAINT person_id FOREIGN KEY (person_id)
        REFERENCES public.person (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
        NOT VALID,
    CONSTRAINT apartment_id FOREIGN KEY (apartment_id)
        REFERENCES public.apartment (estate_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
        NOT VALID
)
    INHERITS (public.contract);

ALTER TABLE public.tenancy_contract
    OWNER to postgres;


CREATE TABLE public.purchase_contract
(
    installment_amount text,
    intrest_rate text,
    person_id integer,
    house_id integer,
    CONSTRAINT purchase_contract_pkey PRIMARY KEY (contract_number),
    CONSTRAINT person_id FOREIGN KEY (person_id)
        REFERENCES public.person (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
        NOT VALID,
    CONSTRAINT house_id FOREIGN KEY (house_id)
        REFERENCES public.house (estate_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
        NOT VALID
)
    INHERITS (public.contract);

ALTER TABLE public.purchase_contract
    OWNER to postgres;
\end{verbatim}






\section{Beispiel für Operatorbaum}

\begin{tikzpicture}
\node (Haustier) {Haustier};
\node (Wolf) [left=25mm of Haustier] {Wolf};
\node (join1) [above=20mm of $(Haustier)!.5!(Wolf)$] {$\verbund{Wolf.WID=Haustier.HID}$};
\node (selektion1) [above=of join1] {$\selektion{Name=\wert{Hasso}}$};
\node (projektion) [above=of selektion1] {$\projektion{Rasse}$};
\node (final) [above=of projektion] {};

\path (Haustier) edge node[smallr,near start,above right] {200 Tupel\\4 Attribute} (join1);
\path (Wolf) edge node[smalll,near start,above left] {1000 Tupel\\6 Attribute} (join1);
\path (join1) edge node[smallr,near start,above left] {?? Tupel\\?? Attribute} (selektion1);
\path (selektion1) edge node[smallr,midway,left] {$??\cdot\frac{??}{??}=??$ Tupel\\?? Attribute} (projektion);
\path (projektion) edge node[smallr,midway,left] {$??$ Tupel\\1 Attribut} (final);
\end{tikzpicture}







\section{Beispiel fürr Tabelle mit Sperranforderungen}

\begin{tabular}{|p{2cm}|p{2cm}|p{2cm}|p{2cm}|p{1cm}|p{1cm}|p{1cm}|p{3cm}|}
\hline
Zeitschritt & T\ts{1} & T\ts{2} & T\ts{3} & x & y & z & Bemerkung\\
\hline
\hline
0 &  &  &  & NL & NL & NL & \\
\hline
1 & lock(x,X) &  &  & X\ts{1} & NL & NL & \\
\hline
2 & write(x) & lock(y,R) &  & X\ts{1} & R\ts{2} & NL & \\
\hline
3 &  &  &  &  &  &  & \\
\hline
4 &  &  &  &  &  &  & \\
\hline
5 &  &  &  &  &  &  & \\
\hline
\end{tabular}



\section{Beispiel für B-  und B*-Bäumen}

Löschen Sie aus dem unten abgebildeten  \textbf{B*-Baum} der Klasse $\tau(1,2,h)$
die Datensätze mit den Schlüsselwerten \textbf{40}, \textbf{43}, \textbf{38}, \textbf{32} und \textbf{90} (in dieser Reihenfolge).
Geben Sie jeweils kurz an, welche konkrete Maßnahme Sie durchgeführt haben (Mischen, Ausgleichen, einfaches Löschen) und zeichnen Sie den Baum nach jedem Mischen und Ausgleichen neu.
Für Ausgleichs- und Mischoperationen sollen nur direkt benachbarte Geschwisterknoten (bevorzugt der rechte) herangezogen werden.

\begin{center}
\begin{tikzpicture}
\tikzstyle{bplus}=[rectangle split, rectangle split horizontal,rectangle split ignore empty parts,draw]
\tikzstyle{every node}=[bplus]
\tikzstyle{level 1}=[sibling distance=30mm]
\tikzstyle{level 2}=[sibling distance=15mm]

\node {12 \nodepart{two} 47  } [->]
 child {node {6 \nodepart{two} 12 \nodepart{three} \;\;\; \nodepart{four} \;\;\; } }
 child {node {32 \nodepart{two} 38 \nodepart{three} 40 \nodepart{four} 43}}
  child {node {86 \nodepart{two} 88 \nodepart{three} 90 \nodepart{four} \;\;\;}}
;\end{tikzpicture}
\end{center}


40 und 43, Einfaches Löschen\\
38, Ausgleichen

\begin{center}
\begin{tikzpicture}
\tikzstyle{bplus}=[rectangle split, rectangle split horizontal,rectangle split ignore empty parts,draw]
\tikzstyle{every node}=[bplus]
\tikzstyle{level 1}=[sibling distance=30mm]
\tikzstyle{level 2}=[sibling distance=15mm]

\node {12 \nodepart{two} 86 } [->]
 child {node {6 \nodepart{two} 12 \nodepart{three} \;\;\; \nodepart{four} \;\;\;}}
 child {node {32 \nodepart{two} 86 \nodepart{three} \;\;\; \nodepart{four} \;\;\;}}
  child {node {88 \nodepart{two} 90 \nodepart{three} \;\;\; \nodepart{four} \;\;\;}}
;\end{tikzpicture}
\end{center}

32, Mischen

\begin{center}
\begin{tikzpicture}
\tikzstyle{bplus}=[rectangle split, rectangle split horizontal,rectangle split ignore empty parts,draw]
\tikzstyle{every node}=[bplus]
\tikzstyle{level 1}=[sibling distance=30mm]
\tikzstyle{level 2}=[sibling distance=15mm]

\node {12} [->]
 child {node {6 \nodepart{two} 12 \nodepart{three} \;\;\; \nodepart{four} \;\;\;}}
 child {node {86 \nodepart{two} 88 \nodepart{three} 90 \nodepart{four} \;\;\;}}
;\end{tikzpicture}
\end{center}

90, Einfaches Löschen







\end{document}